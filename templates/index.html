<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>BTC Live Price</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
    <div class="max-w-3xl w-full p-6">
        <h1 class="text-3xl font-bold text-center mb-6">Bitcoin (BTC) — Live</h1>

        <div class="text-center">
            <div id="price" class="text-5xl font-extrabold mb-4">Loading…</div>
            <div id="status" class="text-sm text-gray-400 mb-6">Updating every 2s</div>
        </div>

        <div class="bg-gray-800 p-4 rounded-lg">
            <canvas id="chart" height="200"></canvas>
        </div>
    </div>

<script>
const prices = [];
const labels = [];
const maxPoints = 30;

const ctx = document.getElementById('chart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'BTC USD',
            data: prices,
            tension: 0.3,
            borderWidth: 2,
            fill: false,
            borderColor: 'rgb(34,197,94)'
        }]
    },
    options: {
        scales: { y: { beginAtZero: false } },
        plugins: { legend: { display: false } }
    }
});

async function updatePrice() {
    try {
        const res = await fetch("/price");
        const data = await res.json();
        const price = Number(data.price);

        if (isNaN(price)) {
            document.getElementById("price").textContent = "Error fetching price";
            return;
        }

        document.getElementById("price").textContent = "$" + price.toLocaleString();
        document.getElementById("status").textContent = "Last updated: " + new Date().toLocaleTimeString();

        // update chart
        prices.push(price);
        labels.push(new Date().toLocaleTimeString());
        if (prices.length > maxPoints) {
            prices.shift();
            labels.shift();
        }
        chart.update();
    } catch (err) {
        document.getElementById("price").textContent = "Error fetching price";
        document.getElementById("status").textContent = "Network error, retrying...";
    }
}

// Initial + repeat every 2 seconds
updatePrice();
setInterval(updatePrice, 2000);
</script>
</body>
</html>
